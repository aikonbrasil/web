---
title: 'Gathering RF info to a Data Base'
date: 2021-05-20
permalink: /tips/2021/05/rfdatabase/
author_profile: false
read_more: enabled
tags:
  - RF
  - Data Base
  - 4G
  - Real Setup
---

***Abstract:*** In order to document the experience of gathering RF information from a real dataset comming from a real 4G (pre-5G) network, I am sharing some key steps used on this experiment, most of them related to Data Base Setup.

Data Base Setup
=======

Creating the DB platform
-------

The main reference is coming from this [ArchLinux documentation](https://wiki.archlinux.org/title/MariaDB){}

1. ```sh
sudo pacman -S mariadb
```

2. ```sh
sudo mariadb-install-db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
```

3. ```sh
sudo systemctl enable mariadb.service
``` 

4. ```sh
sudo systemctl start mariadb.service
``` 


Creating the DB table
-------

1. ```sh
sudo mysql -u root -p
```
Note: to simplify, I have used a blank password for the db root user, it is the default one, however, you can set up another one. 

2. Create the database `RFINFO`
```sh
create database RFINFO;
```

3. Provide grant access to user lut on `RFINFO` database
```sh
grant all privileges on RFINFO.* TO 'lut'@'%';
grant all privileges on RFINFO.* TO 'lut'@'%' identified by 'lut';
flush privileges;
```

4. Create the table and column label for the database
```mysql
CREATE TABLE information( id INT NOT NULL AUTO_INCREMENT, device_id VARCHAR(100) NOT NULL, RSRP TINYINT SIGNED, RSRQ TINYINT SIGNED, RSSI TINYINT SIGNED, SINR TINYINT SIGNED, ts_remote TIMESTAMP, ts_local  TIMESTAMP, PRIMARY KEY (id) );
```

5. To show the content of the database. In some cases it is necessarily to indicate the name of the database to check with the command `USE RFINFO;`
```sh
show tables;
SELECT * FROM information;
```

6. Only in case the user is interested to delete data saved in the database, run the following command
```sh
DELETE from information 
```

Python Script that save info on Data Base
--------


1. The script is 
```python
import socket                                                                                                                                       
from datetime import datetime                                                                                                                                                                  
import sys                                                                                                                              
import string                                                                                                                                       
import mysql.connector                                                                                                                                                                  

portalLocal = int(sys.argv[1])

s = socket.socket()
#port = 12345
s.bind(('',portalLocal))
s.listen(5)
c, addr = s.accept()


mydb = mysql.connector.connect(
        host= "100.100.100.10",
        user= "lut",
        password = "lut",
        database= "RFINFO"
        )

mycursor = mydb.cursor()

sql = "INSERT INTO information VALUES (%s, %s, %s, %s, %s, %s, %s, %s)"

while True:
    try:
        rcvData = c.recv(1024).decode()
    except socket.error:
        pass
    else:
        print('ok')

    if(rcvData == "Bye" or rcvData == "bye"):
        c.close()
        break

    #print("info: ", rcvData)
    rcvData = str(rcvData)
    tmp_list = rcvData.strip().split(' ')
    device_id = tmp_list[0]
    RSRP = int(tmp_list[1])
    RSRQ = int(tmp_list[2])
    RSSI = int(tmp_list[3])
    SINR = int(tmp_list[4])

    pre_ts = tmp_list[6]
    tmp_list_ts = pre_ts.strip().split('|')
    ts_remote = tmp_list_ts[1]+'-'+tmp_list_ts[2]+'-'+tmp_list_ts[3]+' '+tmp_list_ts[4]+':'+tmp_list_ts[5]+':'+tmp_list_ts[6]


    val = (None, device_id, RSRP, RSRQ, RSSI, SINR, ts_remote, None)

    mycursor.execute(sql, val)
    mydb.commit()
    print("info received from id: %s"%(device_id))    
    #print(device_id)
    #print(RSRP)
    #print(RSRQ)
    #print(RSSI)
    #print(SINR)
    #print(ts_remote)

    #if(rcvData == "Bye" or rcvData == "bye"):
    #    c.close()
    #    break
```